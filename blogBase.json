{"singlePage": [], "startSite": "", "filingNum": "", "onePageListNum": 15, "commentLabelColor": "#006b75", "yearColorList": ["#bc4c00", "#0969da", "#1f883d", "#A333D0"], "i18n": "CN", "themeMode": "manual", "dayTheme": "light", "nightTheme": "dark", "urlMode": "pinyin", "script": "", "style": "", "head": "", "indexScript": "", "indexStyle": "", "bottomText": "", "showPostSource": 1, "iconList": {}, "UTC": 8, "rssSplit": "sentence", "exlink": {}, "needComment": 1, "allHead": "", "title": "Blog Title", "subTitle": "Blog description", "avatarUrl": "https://github.githubassets.com/favicons/favicon.svg", "GMEEK_VERSION": "last", "postListJson": {"P2": {"htmlDir": "docs/post/you-xiu-yun-wei-jiao-ben.html", "labels": ["documentation"], "postTitle": "\u4f18\u79c0\u8fd0\u7ef4\u811a\u672c", "postUrl": "post/you-xiu-yun-wei-jiao-ben.html", "postSourceUrl": "https://github.com/ignorantcaomao/ignorantcaomao.github.io/issues/2", "commentNum": 0, "wordCount": 6168, "description": "### \u6839\u636ePID\u8fc7\u6ee4\u8fdb\u7a0b\u6240\u6709\u4fe1\u606f\r\n```shell\r\n#! /bin/bash\r\n# Function: \u6839\u636e\u7528\u6237\u8f93\u5165\u7684PID\uff0c\u8fc7\u6ee4\u51fa\u8be5PID\u6240\u6709\u7684\u4fe1\u606f\r\nread -p '\u8bf7\u8f93\u5165\u8981\u67e5\u8be2\u7684PID: ' P\r\nn=`ps -aux| awk '$2~/^'$P'$/{print $11}'|wc -l`\r\nif [ $n -eq 0 ];then\r\n echo '\u8be5PID\u4e0d\u5b58\u5728\uff01\uff01'\r\n exit\r\nfi\r\necho '--------------------------------'\r\necho '\u8fdb\u7a0bPID: $P'\r\necho '\u8fdb\u7a0b\u547d\u4ee4\uff1a`ps -aux| awk '$2~/^'$P'$/{print $11}'`'\r\necho '\u8fdb\u7a0b\u6240\u5c5e\u7528\u6237: `ps -aux| awk '$2~/^'$P'$/{print $1}'`'\r\necho 'CPU\u5360\u7528\u7387\uff1a`ps -aux| awk '$2~/^'$P'$/{print $3}'`%'\r\necho '\u5185\u5b58\u5360\u7528\u7387\uff1a`ps -aux| awk '$2~/^'$P'$/{print $4}'`%'\r\necho '\u8fdb\u7a0b\u5f00\u59cb\u8fd0\u884c\u7684\u65f6\u523b\uff1a`ps -aux| awk '$2~/^'$P'$/{print $9}'`'\r\necho '\u8fdb\u7a0b\u8fd0\u884c\u7684\u65f6\u95f4\uff1a`ps -aux| awk '$2~/^'$P'$/{print $10}'`'\r\necho '\u8fdb\u7a0b\u72b6\u6001\uff1a`ps -aux| awk '$2~/^'$P'$/{print $8}'`'\r\necho '\u8fdb\u7a0b\u865a\u62df\u5185\u5b58\uff1a`ps -aux| awk '$2~/^'$P'$/{print $5}'`'\r\necho '\u8fdb\u7a0b\u5171\u4eab\u5185\u5b58\uff1a`ps -aux| awk '$2~/^'$P'$/{print $6}'`'\r\necho '--------------------------------'\r\n```\r\n### \u6839\u636e\u8fdb\u7a0b\u540d\u8fc7\u6ee4\u8fdb\u7a0b\u4fe1\u606f\r\n\r\n```shell\r\n#! /bin/bash\r\n# Function: \u6839\u636e\u8f93\u5165\u7684\u7a0b\u5e8f\u7684\u540d\u5b57\u8fc7\u6ee4\u51fa\u6240\u5bf9\u5e94\u7684PID\uff0c\u5e76\u663e\u793a\u51fa\u8be6\u7ec6\u4fe1\u606f\uff0c\u5982\u679c\u6709\u51e0\u4e2aPID\uff0c\u5219\u5168\u90e8\u663e\u793a\r\nread -p '\u8bf7\u8f93\u5165\u8981\u67e5\u8be2\u7684\u8fdb\u7a0b\u540d\uff1a' NAME\r\nN=`ps -aux | grep $NAME | grep -v grep | wc -l` ##\u7edf\u8ba1\u8fdb\u7a0b\u603b\u6570\r\nif [ $N -le 0 ];then\r\n  echo '\u8be5\u8fdb\u7a0b\u540d\u6ca1\u6709\u8fd0\u884c\uff01'\r\nfi\r\ni=1\r\nwhile [ $N -gt 0 ]\r\ndo\r\n  echo '\u8fdb\u7a0bPID: `ps -aux | grep $NAME | grep -v grep | awk 'NR=='$i'{print $0}'| awk '{print $2}'`'\r\n  echo '\u8fdb\u7a0b\u547d\u4ee4\uff1a`ps -aux | grep $NAME | grep -v grep | awk 'NR=='$i'{print $0}'| awk '{print $11}'`'\r\n  echo '\u8fdb\u7a0b\u6240\u5c5e\u7528\u6237: `ps -aux | grep $NAME | grep -v grep | awk 'NR=='$i'{print $0}'| awk '{print $1}'`'\r\n  echo 'CPU\u5360\u7528\u7387\uff1a`ps -aux | grep $NAME | grep -v grep | awk 'NR=='$i'{print $0}'| awk '{print $3}'`%'\r\n  echo '\u5185\u5b58\u5360\u7528\u7387\uff1a`ps -aux | grep $NAME | grep -v grep | awk 'NR=='$i'{print $0}'| awk '{print $4}'`%'\r\n  echo '\u8fdb\u7a0b\u5f00\u59cb\u8fd0\u884c\u7684\u65f6\u523b\uff1a`ps -aux | grep $NAME | grep -v grep | awk 'NR=='$i'{print $0}'| awk '{print $9}'`'\r\n  echo '\u8fdb\u7a0b\u8fd0\u884c\u7684\u65f6\u95f4\uff1a` ps -aux | grep $NAME | grep -v grep | awk 'NR=='$i'{print $0}'| awk '{print $11}'`'\r\n  echo '\u8fdb\u7a0b\u72b6\u6001\uff1a`ps -aux | grep $NAME | grep -v grep | awk 'NR=='$i'{print $0}'| awk '{print $8}'`'\r\n  echo '\u8fdb\u7a0b\u865a\u62df\u5185\u5b58\uff1a`ps -aux | grep $NAME | grep -v grep | awk 'NR=='$i'{print $0}'| awk '{print $5}'`'\r\n  echo '\u8fdb\u7a0b\u5171\u4eab\u5185\u5b58\uff1a`ps -aux | grep $NAME | grep -v grep | awk 'NR=='$i'{print $0}'| awk '{print $6}'`'\r\n  echo '***************************************************************'\r\n  let N-- i++\r\ndone\r\n```\r\n### \u6839\u636e\u7528\u6237\u540d\u67e5\u8be2\u8be5\u7528\u6237\u7684\u76f8\u5173\u4fe1\u606f\r\n\r\n```shell\r\n#! /bin/bash\r\n# Function\uff1a\u6839\u636e\u7528\u6237\u540d\u67e5\u8be2\u8be5\u7528\u6237\u7684\u6240\u6709\u4fe1\u606f\r\nread -p '\u8bf7\u8f93\u5165\u8981\u67e5\u8be2\u7684\u7528\u6237\u540d\uff1a' A\r\necho '------------------------------'\r\nn=`cat /etc/passwd | awk -F: '$1~/^'$A'$/{print}' | wc -l`\r\nif [ $n -eq 0 ];then\r\necho '\u8be5\u7528\u6237\u4e0d\u5b58\u5728'\r\necho '------------------------------'\r\nelse\r\n  echo '\u8be5\u7528\u6237\u7684\u7528\u6237\u540d\uff1a$A'\r\n  echo '\u8be5\u7528\u6237\u7684UID\uff1a`cat /etc/passwd | awk -F: '$1~/^'$A'$/{print}'|awk -F: '{print $3}'`'\r\n  echo '\u8be5\u7528\u6237\u7684\u7ec4\u4e3a\uff1a`id $A | awk {'print $3'}`'\r\n  echo '\u8be5\u7528\u6237\u7684GID\u4e3a\uff1a`cat /etc/passwd | awk -F: '$1~/^'$A'$/{print}'|awk -F: '{print $4}'`'\r\n  echo '\u8be5\u7528\u6237\u7684\u5bb6\u76ee\u5f55\u4e3a\uff1a`cat /etc/passwd | awk -F: '$1~/^'$A'$/{print}'|awk -F: '{print $6}'`'\r\n  Login=`cat /etc/passwd | awk -F: '$1~/^'$A'$/{print}'|awk -F: '{print $7}'`\r\n  if [ $Login == '/bin/bash' ];then\r\n  echo '\u8be5\u7528\u6237\u6709\u767b\u5f55\u7cfb\u7edf\u7684\u6743\u9650\uff01\uff01'\r\n  echo '------------------------------'\r\n  elif [ $Login == '/sbin/nologin' ];then\r\n  echo '\u8be5\u7528\u6237\u6ca1\u6709\u767b\u5f55\u7cfb\u7edf\u7684\u6743\u9650\uff01\uff01'\r\n  echo '------------------------------'\r\n  fi\r\nfi\r\n```\r\n### \u52a0\u56fa\u7cfb\u7edf\u7684\u4e00\u4e9b\u914d\u7f6e\r\n\r\n```shell\r\n#! /bin/bash\r\n# Function:\u5bf9\u8d26\u6237\u7684\u5bc6\u7801\u7684\u4e00\u4e9b\u52a0\u56fa\r\nread -p '\u8bbe\u7f6e\u5bc6\u7801\u6700\u591a\u53ef\u591a\u5c11\u5929\u4e0d\u4fee\u6539\uff1a' A\r\nread -p '\u8bbe\u7f6e\u5bc6\u7801\u4fee\u6539\u4e4b\u95f4\u6700\u5c0f\u7684\u5929\u6570\uff1a' B\r\nread -p '\u8bbe\u7f6e\u5bc6\u7801\u6700\u77ed\u7684\u957f\u5ea6\uff1a' C\r\nread -p '\u8bbe\u7f6e\u5bc6\u7801\u5931\u6548\u524d\u591a\u5c11\u5929\u901a\u77e5\u7528\u6237\uff1a' D\r\nsed -i '/^PASS_MAX_DAYS/c\\PASS_MAX_DAYS '$A'' /etc/login.defs\r\nsed -i '/^PASS_MIN_DAYS/c\\PASS_MIN_DAYS '$B'' /etc/login.defs\r\nsed -i '/^PASS_MIN_LEN/c\\PASS_MIN_LEN '$C'' /etc/login.defs\r\nsed -i '/^PASS_WARN_AGE/c\\PASS_WARN_AGE '$D'' /etc/login.defs\r\n\r\necho '\u5df2\u5bf9\u5bc6\u7801\u8fdb\u884c\u52a0\u56fa\uff0c\u65b0\u7528\u6237\u4e0d\u5f97\u548c\u65e7\u5bc6\u7801\u76f8\u540c\uff0c\u4e14\u65b0\u5bc6\u7801\u5fc5\u987b\u540c\u65f6\u5305\u542b\u6570\u5b57\u3001\u5c0f\u5199\u5b57\u6bcd\uff0c\u5927\u5199\u5b57\u6bcd\uff01\uff01'\r\nsed -i '/pam_pwquality.so/c\\password requisite pam_pwquality.so try_first_pass local_users_only retry=3 authtok_type= difok=1 minlen=8 ucredit=-1 lcredit=-1 dcredit=-1' /etc/pam.d/system-auth\r\n\r\necho '\u5df2\u5bf9\u5bc6\u7801\u8fdb\u884c\u52a0\u56fa\uff0c\u5982\u679c\u8f93\u5165\u9519\u8bef\u5bc6\u7801\u8d85\u8fc73\u6b21\uff0c\u5219\u9501\u5b9a\u8d26\u6237\uff01\uff01'\r\nn=`cat /etc/pam.d/sshd | grep 'auth required pam_tally2.so '|wc -l`\r\nif [ $n -eq 0 ];then\r\nsed -i '/%PAM-1.0/a\\auth required pam_tally2.so deny=3 unlock_time=150 even_deny_root root_unlock_time300' /etc/pam.d/sshd\r\nfi\r\n\r\necho  '\u5df2\u8bbe\u7f6e\u7981\u6b62root\u7528\u6237\u8fdc\u7a0b\u767b\u5f55\uff01\uff01'\r\nsed -i '/PermitRootLogin/c\\PermitRootLogin no'  /etc/ssh/sshd_config\r\n\r\nread -p '\u8bbe\u7f6e\u5386\u53f2\u547d\u4ee4\u4fdd\u5b58\u6761\u6570\uff1a' E\r\nread -p '\u8bbe\u7f6e\u8d26\u6237\u81ea\u52a8\u6ce8\u9500\u65f6\u95f4\uff1a' F\r\nsed -i '/^HISTSIZE/c\\HISTSIZE='$E'' /etc/profile\r\nsed -i '/^HISTSIZE/a\\TMOUT='$F'' /etc/profile\r\n\r\necho '\u5df2\u8bbe\u7f6e\u53ea\u5141\u8bb8wheel\u7ec4\u7684\u7528\u6237\u53ef\u4ee5\u4f7f\u7528su\u547d\u4ee4\u5207\u6362\u5230root\u7528\u6237\uff01'\r\nsed -i '/pam_wheel.so use_uid/c\\auth required pam_wheel.so use_uid ' /etc/pam.d/su\r\nn=`cat /etc/login.defs | grep SU_WHEEL_ONLY | wc -l`\r\nif [ $n -eq 0 ];then\r\necho SU_WHEEL_ONLY yes >> /etc/login.defs\r\nfi\r\n\r\necho '\u5373\u5c06\u5bf9\u7cfb\u7edf\u4e2d\u7684\u8d26\u6237\u8fdb\u884c\u68c0\u67e5....'\r\necho '\u7cfb\u7edf\u4e2d\u6709\u767b\u5f55\u6743\u9650\u7684\u7528\u6237\u6709\uff1a'\r\nawk -F: '($7=='/bin/bash'){print $1}' /etc/passwd\r\necho '********************************************'\r\necho '\u7cfb\u7edf\u4e2dUID=0\u7684\u7528\u6237\u6709\uff1a'\r\nawk -F: '($3=='0'){print $1}' /etc/passwd\r\necho '********************************************'\r\nN=`awk -F: '($2==''){print $1}' /etc/shadow|wc -l`\r\necho '\u7cfb\u7edf\u4e2d\u7a7a\u5bc6\u7801\u7528\u6237\u6709\uff1a$N'\r\nif [ $N -eq 0 ];then\r\n echo '\u606d\u559c\u4f60\uff0c\u7cfb\u7edf\u4e2d\u65e0\u7a7a\u5bc6\u7801\u7528\u6237\uff01\uff01'\r\n echo '********************************************'\r\nelse\r\n i=1\r\n while [ $N -gt 0 ]\r\n do\r\n    None=`awk -F: '($2==''){print $1}' /etc/shadow|awk 'NR=='$i'{print}'`\r\n    echo '------------------------'\r\n    echo $None\r\n    echo '\u5fc5\u987b\u4e3a\u7a7a\u7528\u6237\u8bbe\u7f6e\u5bc6\u7801\uff01\uff01'\r\n    passwd $None\r\n    let N--\r\n done\r\n M=`awk -F: '($2==''){print $1}' /etc/shadow|wc -l`\r\n if [ $M -eq 0 ];then\r\n  echo '\u606d\u559c\uff0c\u7cfb\u7edf\u4e2d\u5df2\u7ecf\u6ca1\u6709\u7a7a\u5bc6\u7801\u7528\u6237\u4e86\uff01'\r\n else\r\necho '\u7cfb\u7edf\u4e2d\u8fd8\u5b58\u5728\u7a7a\u5bc6\u7801\u7528\u6237\uff1a$M'\r\n fi\r\nfi\r\n\r\necho '\u5373\u5c06\u5bf9\u7cfb\u7edf\u4e2d\u91cd\u8981\u6587\u4ef6\u8fdb\u884c\u9501\u5b9a\uff0c\u9501\u5b9a\u540e\u5c06\u65e0\u6cd5\u6dfb\u52a0\u5220\u9664\u7528\u6237\u548c\u7ec4'\r\nread -p '\u8b66\u544a\uff1a\u6b64\u811a\u672c\u8fd0\u884c\u540e\u5c06\u65e0\u6cd5\u6dfb\u52a0\u5220\u9664\u7528\u6237\u548c\u7ec4\uff01\uff01\u786e\u5b9a\u8f93\u5165Y\uff0c\u53d6\u6d88\u8f93\u5165N\uff1bY/N\uff1a' i\r\ncase $i in\r\n      [Y,y])\r\n            chattr +i /etc/passwd\r\n            chattr +i /etc/shadow\r\n            chattr +i /etc/group\r\n            chattr +i /etc/gshadow\r\n            echo '\u9501\u5b9a\u6210\u529f\uff01'\r\n;;\r\n      [N,n])\r\n            chattr -i /etc/passwd\r\n            chattr -i /etc/shadow\r\n            chattr -i /etc/group\r\n            chattr -i /etc/gshadow\r\n            echo '\u53d6\u6d88\u9501\u5b9a\u6210\u529f\uff01\uff01'\r\n;;\r\n       *)\r\n            echo '\u8bf7\u8f93\u5165Y/y or N/n'\r\nesac\r\n```\r\n\r\n### ssh \u8fdc\u7a0b\u8fde\u63a5\u514d\u8f93\u5bc6\u7801\r\n```shell\r\n#!/bin/bash\r\n \r\n# \u5b89\u88c5sshpass\u5de5\u5177\r\nyum install -y sshpass\r\n\r\n# \u76ee\u6807\u670d\u52a1\u5668\u7684IP\u5730\u5740\u6216\u4e3b\u673a\u540d\r\nHOST='192.168.3.55'\r\n# \u767b\u5f55\u7528\u6237\u540d\r\nUSER='root'\r\n# \u767b\u5f55\u5bc6\u7801\r\nPASS='1-techstar'\r\n# \u8981\u6267\u884c\u7684\u547d\u4ee4\r\nCOMMAND='ls'\r\n \r\n# \u4f7f\u7528sshpass\u6267\u884cSSH\u547d\u4ee4\r\nsshpass -p $PASS ssh -o StrictHostKeyChecking=no -p 22 $USER@$HOST $COMMAND\r\n```\u3002", "top": 0, "createdAt": 1728545593, "style": "", "script": "", "head": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2024-10-10", "dateLabelColor": "#bc4c00"}, "P3": {"htmlDir": "docs/post/zhan-dian-ke-kao-xing-gong-cheng- SRE -zui-jia-shi-jian- -- -huang-jin-jian-kong-xin-hao.html", "labels": ["documentation"], "postTitle": "\u7ad9\u70b9\u53ef\u9760\u6027\u5de5\u7a0b SRE \u6700\u4f73\u5b9e\u8df5 -- \u9ec4\u91d1\u76d1\u63a7\u4fe1\u53f7", "postUrl": "post/zhan-dian-ke-kao-xing-gong-cheng-%20SRE%20-zui-jia-shi-jian-%20--%20-huang-jin-jian-kong-xin-hao.html", "postSourceUrl": "https://github.com/ignorantcaomao/ignorantcaomao.github.io/issues/3", "commentNum": 0, "wordCount": 4473, "description": "```python\r\nfrom fastapi import FastAPI, Request, HTTPException, Response\r\nfrom prometheus_client import Counter, Gauge, Histogram, generate_latest, CONTENT_TYPE_LATEST\r\nfrom starlette.responses import StreamingResponse\r\nimport time\r\nimport psutil\r\n\r\napp = FastAPI()\r\n\r\n# Define Prometheus metrics\r\nhttp_requests_total = Counter(\r\n    'http_requests_total',\r\n    'Total number of HTTP requests',\r\n    ['method', 'endpoint', 'http_status']\r\n)\r\nhttp_request_duration_seconds = Histogram(\r\n    'http_request_duration_seconds',\r\n    'HTTP request duration in seconds',\r\n    ['method', 'endpoint']\r\n)\r\nhttp_request_size_bytes = Histogram(\r\n    'http_request_size_bytes',\r\n    'HTTP request size in bytes',\r\n    ['method', 'endpoint']\r\n)\r\nhttp_response_size_bytes = Histogram(\r\n    'http_response_size_bytes',\r\n    'HTTP response size in bytes',\r\n    ['method', 'endpoint']\r\n)\r\nactive_requests = Gauge(\r\n    'active_requests',\r\n    'Number of active requests'\r\n)\r\nerror_counter = Counter(\r\n    'error_counter',\r\n    'Total number of HTTP errors',\r\n    ['method', 'endpoint', 'http_status']\r\n)\r\n\r\ncpu_usage = Gauge('cpu_usage_percent', 'CPU usage in percent')\r\nmemory_usage = Gauge('memory_usage_percent', 'Memory usage in percent')\r\ndisk_usage = Gauge('disk_usage_percent', 'Disk usage in percent')\r\nnetwork_in = Gauge('network_received_bytes', 'Network received bytes')\r\nnetwork_out = Gauge('network_sent_bytes', 'Network sent bytes')\r\n\r\n@app.middleware('http')\r\nasync def record_request_start_time(request: Request, call_next):\r\n    request.state.start_time = time.time()\r\n    response = await call_next(request)\r\n    return response\r\n\r\n@app.middleware('http')\r\nasync def record_request_end_time(request: Request, call_next):\r\n    response = await call_next(request)\r\n    latency = time.time() - request.state.start_time\r\n    http_request_duration_seconds.labels(\r\n        request.method, request.url.path\r\n    ).observe(latency)\r\n    http_request_size_bytes.labels(\r\n        request.method, request.url.path\r\n    ).observe(request.headers.get('Content-Length', 0))\r\n    if isinstance(response, StreamingResponse):\r\n        response_size = 0\r\n    else:\r\n        response_size = len(response.content)\r\n    http_response_size_bytes.labels(\r\n        request.method, request.url.path\r\n    ).observe(response_size)\r\n    http_requests_total.labels(\r\n        request.method, request.url.path, response.status_code\r\n    ).inc()\r\n    return response\r\n\r\n@app.middleware('http')\r\nasync def increment_counter(request: Request, call_next):\r\n    active_requests.inc()\r\n    response = await call_next(request)\r\n    active_requests.dec()\r\n    return response\r\n\r\n@app.middleware('http')\r\nasync def log_saturation(request: Request, call_next):\r\n    max_concurrent_requests = 10  # set the maximum number of concurrent requests\r\n    saturation_ratio = active_requests._value._value / max_concurrent_requests\r\n    print(f'Saturation: {saturation_ratio}')\r\n    return await call_next(request)\r\n\r\n@app.middleware('http')\r\nasync def increment_error_counter(request: Request, call_next):\r\n    try:\r\n        response = await call_next(request)\r\n        return response\r\n    except HTTPException as e:\r\n        error_counter.labels(\r\n            request.method, request.url.path, e.status_code\r\n        ).inc()\r\n        print(f'Incremented error counter for {request.method} {request.url.path} {e.status_code}')\r\n        raise e\r\n\r\n\r\n@app.get('/')\r\nasync def root():\r\n    return {'message': 'FastAPI server is running. Metrics are available at /metrics'}\r\n\r\n\r\n@app.get('/generate_traffic')\r\nasync def generate_traffic():\r\n    for i in range(100):\r\n        response = await root()\r\n        print(response)\r\n    return {'message': 'Generated traffic successfully.'}\r\n\r\n\r\n@app.get('/generate_error')\r\nasync def generate_error():\r\n    raise HTTPException(status_code=500, detail='Generated an error.')\r\n\r\n# \u83b7\u53d6\u548c\u66f4\u65b0\u7cfb\u7edf\u76d1\u63a7\u6570\u636e\r\ndef collect_system_metrics():\r\n    # \u66f4\u65b0 CPU \u4f7f\u7528\u7387\r\n    cpu_usage.set(psutil.cpu_percent(interval=1))\r\n    \r\n    # \u66f4\u65b0\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\r\n    memory = psutil.virtual_memory()\r\n    memory_usage.set(memory.percent)\r\n    \r\n    # \u66f4\u65b0\u78c1\u76d8\u4f7f\u7528\u60c5\u51b5\r\n    disk = psutil.disk_usage('/')\r\n    disk_usage.set(disk.percent)\r\n    \r\n    # \u66f4\u65b0\u7f51\u7edc\u6d41\u91cf\r\n    net_io = psutil.net_io_counters()\r\n    network_in.set(net_io.bytes_recv)\r\n    network_out.set(net_io.bytes_sent)\r\n\r\n@app.get('/metrics')\r\nasync def metrics():\r\n    collect_system_metrics()\r\n    return Response(content=generate_latest(), media_type=CONTENT_TYPE_LATEST)\r\n```\r\n\u3002", "top": 0, "createdAt": 1731491402, "style": "", "script": "", "head": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2024-11-13", "dateLabelColor": "#bc4c00"}, "P4": {"htmlDir": "docs/post/docker-compose -bu-shu-pei-zhi-mysql -zhu-cong.html", "labels": ["documentation"], "postTitle": "docker-compose \u90e8\u7f72\u914d\u7f6emysql \u4e3b\u4ece", "postUrl": "post/docker-compose%20-bu-shu-pei-zhi-mysql%20-zhu-cong.html", "postSourceUrl": "https://github.com/ignorantcaomao/ignorantcaomao.github.io/issues/4", "commentNum": 0, "wordCount": 3877, "description": "\u4f7f\u7528 **Docker Compose** \u642d\u5efa **MySQL \u4e3b\u4ece\u590d\u5236**\u662f\u4e00\u79cd\u5feb\u901f\u3001\u9ad8\u6548\u7684\u65b9\u5f0f\u3002", "top": 0, "createdAt": 1732244220, "style": "", "script": "", "head": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2024-11-22", "dateLabelColor": "#bc4c00"}, "P5": {"htmlDir": "docs/post/k8s -wen-ti-pai-cha-liu-cheng-tu.html", "labels": ["documentation"], "postTitle": "k8s \u95ee\u9898\u6392\u67e5\u6d41\u7a0b\u56fe", "postUrl": "post/k8s%20-wen-ti-pai-cha-liu-cheng-tu.html", "postSourceUrl": "https://github.com/ignorantcaomao/ignorantcaomao.github.io/issues/5", "commentNum": 0, "wordCount": 105, "description": "![\u5fae\u4fe1\u56fe\u7247_20241204101902](https://github.com/user-attachments/assets/0f06e502-0029-45af-bacb-8956f50359e2)\r\n\u3002", "top": 0, "createdAt": 1733278794, "style": "", "script": "", "head": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2024-12-04", "dateLabelColor": "#bc4c00"}, "P6": {"htmlDir": "docs/post/11 -ge-bi-bei- Docker -gong-ju.html", "labels": ["documentation"], "postTitle": "11 \u4e2a\u5fc5\u5907 Docker \u5de5\u5177", "postUrl": "post/11%20-ge-bi-bei-%20Docker%20-gong-ju.html", "postSourceUrl": "https://github.com/ignorantcaomao/ignorantcaomao.github.io/issues/6", "commentNum": 0, "wordCount": 49, "description": "https://mp.weixin.qq.com/s/pjvjTXhcrON0FdAak1pxWw\u3002", "top": 0, "createdAt": 1733279590, "style": "", "script": "", "head": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2024-12-04", "dateLabelColor": "#bc4c00"}, "P7": {"htmlDir": "docs/post/shi-yong- Helm -an-zhuang-he-guan-li- Istio.html", "labels": ["documentation"], "postTitle": "\u4f7f\u7528 Helm \u5b89\u88c5\u548c\u7ba1\u7406 Istio", "postUrl": "post/shi-yong-%20Helm%20-an-zhuang-he-guan-li-%20Istio.html", "postSourceUrl": "https://github.com/ignorantcaomao/ignorantcaomao.github.io/issues/7", "commentNum": 0, "wordCount": 1917, "description": "\u4f7f\u7528 Helm \u5b89\u88c5\u548c\u7ba1\u7406 Istio \u662f\u4e00\u79cd\u975e\u5e38\u7075\u6d3b\u7684\u65b9\u5f0f\uff0c\u9002\u5408\u9700\u8981\u81ea\u5b9a\u4e49\u914d\u7f6e\u7684\u7528\u6237\u3002", "top": 0, "createdAt": 1733996449, "style": "", "script": "", "head": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2024-12-12", "dateLabelColor": "#bc4c00"}, "P8": {"htmlDir": "docs/post/gou-jian-zhi-chi-hun-he-jia-gou-de- Docker -jing-xiang.html", "labels": ["documentation"], "postTitle": "\u6784\u5efa\u652f\u6301\u6df7\u5408\u67b6\u6784\u7684 Docker \u955c\u50cf", "postUrl": "post/gou-jian-zhi-chi-hun-he-jia-gou-de-%20Docker%20-jing-xiang.html", "postSourceUrl": "https://github.com/ignorantcaomao/ignorantcaomao.github.io/issues/8", "commentNum": 0, "wordCount": 2901, "description": "\u8981\u5b9e\u73b0\u57fa\u4e8e x86 \u67b6\u6784\u6784\u5efa\u652f\u6301 x86 \u548c ARM \u6df7\u5408\u67b6\u6784\u7684 Docker \u955c\u50cf\uff0c\u5e76\u786e\u4fdd\u4e0d\u540c\u67b6\u6784\u7684\u8bbe\u5907\u62c9\u53d6\u5339\u914d\u7684\u955c\u50cf\uff0c\u53ef\u4ee5\u4f7f\u7528 Docker \u7684 Buildx \u5de5\u5177\u8fdb\u884c\u591a\u67b6\u6784\u6784\u5efa\u5e76\u63a8\u9001\u5230\u955c\u50cf\u4ed3\u5e93\u3002", "top": 0, "createdAt": 1734080535, "style": "", "script": "", "head": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2024-12-13", "dateLabelColor": "#bc4c00"}, "P9": {"htmlDir": "docs/post/K8S -shang-Prometheus-ju-ti-shi-jian.html", "labels": ["documentation"], "postTitle": "K8S \u4e0aPrometheus\u5177\u4f53\u5b9e\u8df5", "postUrl": "post/K8S%20-shang-Prometheus-ju-ti-shi-jian.html", "postSourceUrl": "https://github.com/ignorantcaomao/ignorantcaomao.github.io/issues/9", "commentNum": 0, "wordCount": 11592, "description": "\u5728 Kubernetes \u4e0a\u90e8\u7f72 Prometheus \u65f6\uff0c\u63a8\u8350\u4f7f\u7528 **Prometheus Operator**\uff0c\u5b83\u53ef\u4ee5\u6781\u5927\u5730\u7b80\u5316 Prometheus \u7684\u914d\u7f6e\u548c\u7ba1\u7406\u3002", "top": 0, "createdAt": 1734317589, "style": "", "script": "", "head": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2024-12-16", "dateLabelColor": "#bc4c00"}, "P10": {"htmlDir": "docs/post/Jenkins pipeline -yang-li-jiao-ben.html", "labels": ["documentation"], "postTitle": "Jenkins pipeline \u6837\u4f8b\u811a\u672c", "postUrl": "post/Jenkins%20pipeline%20-yang-li-jiao-ben.html", "postSourceUrl": "https://github.com/ignorantcaomao/ignorantcaomao.github.io/issues/10", "commentNum": 0, "wordCount": 14357, "description": "### \u540e\u7aefjava pipeline\u811a\u672c\r\n```groovy\r\n// \u505a\u4e0b\u62c9\u6846\u8054\u52a8\r\n// \u9700\u8981\u7528\u5230scriptler\u63d2\u4ef6\r\n// \u4e0b\u9762\u662fscriptler\u4e2d\u7684\u6837\u4f8b\u811a\u672c\r\n/**\r\nList devList  = ['None']\r\nList testList  = ['itmg-ariot-abs-iot-manager']\r\nList stageList = ['Select:selected', 'stage1']\r\nList prodList  = ['itmg-ariot-abs-iot-manager']\r\n\r\nList default_item = ['None']\r\n\r\nif (Environment == 'DEV') {\r\n  return devList\r\n} else if (Environment == 'TEST') {\r\n  return testList\r\n} else if (Environment == 'STAGE') {\r\n  return stageList\r\n} else if (Environment == 'PROD') {\r\n  return prodList\r\n} else {\r\n  return default_item\r\n}\r\n*/\r\n\r\nproperties([\r\n  // \u7ba1\u9053\u901f\u5ea6/\u8010\u4e45\u6027\u8986\u76d6\r\n  durabilityHint('PERFORMANCE_OPTIMIZED'), \r\n  // \u4fdd\u7559\u5df2\u5b8c\u6210\u6784\u5efa\u7684\u50a8\u85cf\r\n  preserveStashes(), \r\n  // \u914d\u7f6e\u8054\u52a8\u9009\u6846\r\n  parameters([\r\n    activeChoice(choiceType: 'PT_SINGLE_SELECT', description: '\u9009\u7c7b\u578b', filterLength: 1, filterable: false, name: 'Environment', randomName: 'choice-parameter-779608790271869', script: scriptlerScript(isSandboxed: true, scriptlerBuilder: [builderId: '1726884996564_17', parameters: [], propagateParams: false, scriptId: 'Environments.groovy'])), \r\n    reactiveChoice(choiceType: 'PT_CHECKBOX', description: '\u5e94\u7528\u5217\u8868', filterLength: 1, filterable: true, name: 'Servers', randomName: 'choice-parameter-779608792418725', referencedParameters: 'Environment', script: scriptlerScript(isSandboxed: true, scriptlerBuilder: [builderId: '1726884996566_18', parameters: [], propagateParams: false, scriptId: 'BackendAriot.groovy']))\r\n    ])\r\n  ])\r\n\r\npipeline {\r\n    agent any\r\n    \r\n    tools {\r\n      maven 'local-mvn'\r\n      jdk 'jdk-11'\r\n    }\r\n\r\n    options {\r\n        buildDiscarder(logRotator(numToKeepStr: '3')) //\u4fdd\u7559\u4e09\u4e2a\u5386\u53f2\u6784\u5efa\u7248\u672c\r\n    }\r\n\r\n    parameters {\r\n        // \u4ee3\u7801\u5730\u5740\r\n        string(defaultValue: 'http://114.255.128.176:88/syb-dev/root/h-itmg/service/bcl/ariot.git', description: '\u4ee3\u7801\u4ed3\u5e93\u5730\u5740', name: 'Gitlab_Registry_URL')\r\n        // \u7248\u672c\u5206\u652f\r\n        gitParameter(branch: '', branchFilter: '.*', defaultValue: 'sz_dev', description: '\u4ee3\u7801\u5206\u652f', name: 'branch', quickFilterEnabled: false, selectedValue: 'NONE', sortMode: 'NONE', tagFilter: '*', type: 'GitParameterDefinition')\r\n    }\r\n\r\n    environment {\r\n        commitLog = ''\r\n        commit_author = ''\r\n        SonarQube_URL='http://192.168.3.30:9100'\r\n        SonarQube_Secret='sqa_cdfa9063791ff2b619703c6ed3d55cad84ea7407'\r\n        ProjectName='${env.JOB_NAME}'\r\n        scannerHome = tool 'SonarQube_Scanner_4.8'\r\n        DOCKER_REPOSITORY='registry.cn-gdgz1.ctyun.cn/h-vpp'\r\n        build_time = ''\r\n        build_dir = 'itmg-bcl-ariot-abs'\r\n        multiple_platform = '--platform=linux/arm64,linux/amd64'\r\n    }\r\n    \r\n\r\n    stages {\r\n        stage('\u4ee3\u7801\u62c9\u53d6') {\r\n            steps {\r\n                echo '\u62c9\u53d6Git\u4ee3\u7801'\r\n                checkout scmGit(branches: [[name: '${branch}']], extensions: [], userRemoteConfigs: [[credentialsId: '53773151-da42-4355-8504-45bcb0abb1eb', url: '${Gitlab_Registry_URL}']])\r\n                \r\n                script{\r\n                  // \u83b7\u53d6\u6700\u8fd1\u4e00\u6b21\u4ee3\u7801\u63d0\u4ea4\u4fe1\u606f\r\n                  commitLog = sh(script: 'git log --oneline -n 1',returnStdout: true).trim()\r\n                  echo 'Git Commit Log:\\n${commitLog}'\r\n                  \r\n                  commit_author = sh(script: 'git log -n 1 --pretty=format:'%an'',returnStdout: true).trim()\r\n                  echo 'Git Commit Author:\\n${commit_author}'\r\n        \r\n                  commit_counters = sh(script: 'git log --oneline | wc -l',returnStdout: true).trim()\r\n                  echo 'Git Commit Counters:\\n${commit_counters}'\r\n\r\n                  build_time = sh (script: 'date +%Y%m%d%H%M', returnStdout: true).trim()\r\n                  echo 'build time:\\n${build_time}'\r\n                } \r\n            }\r\n        }\r\n\r\n        stage('SonarQube Analysis') {\r\n            when {\r\n              expression { \r\n                  // \u68c0\u67e5\u590d\u9009\u6846\u7684\u503c\uff0c\u5982\u679c\u5305\u542b'DEV'\uff0c\u5219\u6267\u884c\u6b65\u9aa4\r\n                  return params.Environment.contains('DEV') \r\n              }\r\n            }\r\n            steps{\r\n                echo '\u4ee3\u7801\u8d28\u91cf\u68c0\u67e5'\r\n                script{\r\n                    def SonarQube_URL=env.SonarQube_URL\r\n                    def SonarQube_Secret=env.SonarQube_Secret\r\n\r\n                    echo '${ProjectName}'\r\n                    echo '${SonarQube_URL}'\r\n                    echo '${SonarQube_Secret}'\r\n                    def sonarProperties = [\r\n                            'sonar.projectKey=${ProjectName}',\r\n                            'sonar.host.url=${SonarQube_URL}',\r\n                            'sonar.login=${SonarQube_Secret}'\r\n                            ]\r\n                    withSonarQubeEnv('SonarQube') {\r\n                        sh 'mvn sonar:sonar -D${sonarProperties.join(' -D')}'\r\n                    }\r\n                    \r\n                    // \u4ee3\u7801\u68c0\u6d4b\u5931\u8d25,\u5c06\u4e0d\u518d\u7ee7\u7eed\u6267\u884c\u540e\u9762\u7684\u4efb\u52a1,\u76f4\u63a5\u9000\u51fa,\u62a5\u544a\u8fd4\u56de\u7684\u8d85\u65f6\u65f6\u957f\u8bbe\u4e3a5\u5206\u949f\r\n                    timeout(time: 3,unit: 'MINUTES') {\r\n                        waitForQualityGate abortPipeline: true\r\n                    }\r\n                }\r\n            }\r\n        }\r\n       // \u5f15\u7528\u5176\u4ed6\u7684\u5305\r\n        stage('\u6784\u5efa\u57fa\u7840\u4f9d\u8d56') {\r\n          when {\r\n            anyOf {\r\n              expression { return params.Environment.contains('TEST') }\r\n              expression { return params.Environment.contains('PROD') } \r\n            }\r\n          }  \r\n          steps {\r\n            echo '\u6784\u5efa\u57fa\u7840\u4f9d\u8d56'\r\n            script {\r\n\r\n              // \u4f7f\u7528build\u8c03\u5ea6\u524d\u7aefjob\uff0c\u5e76\u4f20\u53c2\uff0c\u5c06\u7ed3\u679c\u8d4b\u503c\u7ed9dtkBuild\r\n            //   def dtkBuild=build(job: 'backend-dtk', parameters: [gitParameter(name: 'branch', value: params.branch)])       \r\n            //   println dtkBuild.getProjectName()\r\n            //   println dtkBuild.getNumber()\r\n            //   println dtkBuild.getBuildVariables() \r\n              // println dtkBuild.buildVariables.image_tag\r\n              // \u4f7f\u7528build\u8c03\u5ea6\u524d\u7aefjob\uff0c\u5e76\u4f20\u53c2\uff0c\u5c06\u7ed3\u679c\u8d4b\u503c\u7ed9dtkBuild\r\n              def iotBuild=build(job: 'backend-iot', parameters: [gitParameter(name: 'branch', value: params.branch)])       \r\n              println iotBuild.getProjectName()\r\n              println iotBuild.getNumber()\r\n              println iotBuild.getBuildVariables() \r\n            }\r\n\r\n          }\r\n        }\r\n        \r\n        \r\n        stage('\u7f16\u8bd1') {\r\n          when {\r\n            anyOf {\r\n              expression { return params.Environment.contains('TEST') }\r\n              expression { return params.Environment.contains('PROD') } \r\n            }\r\n          }  \r\n          steps {\r\n            echo '\u7f16\u8bd1\u6253\u5305'\r\n            script {\r\n              sh 'mvn clean install -Dmaven.test.skip=true -Ddockerfile.skip=true'\r\n            }\r\n\r\n          }\r\n        }\r\n\r\n         stage('\u6253\u5305\u955c\u50cf') {\r\n           when {\r\n               anyOf {\r\n                 expression { return params.Environment.contains('TEST') }\r\n                 expression { return params.Environment.contains('PROD') } \r\n               }\r\n           }  \r\n           steps {\r\n             echo '\u6253\u5305\u955c\u50cf'\r\n             script {\r\n               for (server in params.Servers.tokenize(',')) {\r\n                 sh 'docker build -t ${DOCKER_REPOSITORY}/${server}:${build_time}_${commit_counters} ${build_dir}/${server} --no-cache'\r\n                 sh 'docker push ${DOCKER_REPOSITORY}/${server}:${build_time}_${commit_counters}'\r\n                 sh 'docker rmi ${DOCKER_REPOSITORY}/${server}:${build_time}_${commit_counters}'\r\n               }\r\n             }\r\n\r\n           }\r\n         }\r\n        \r\n        stage('\u90e8\u7f72') {\r\n          when {\r\n            expression { return params.Environment.contains('TEST') }\r\n          }  \r\n          steps {\r\n            echo '\u90e8\u7f72\u5230\u6d4b\u8bd5\u73af\u5883'\r\n            \r\n            script {\r\n              for (server in params.Servers.tokenize(',')) {\r\n                def substr = server.split('-')[-1]\r\n                def deploy = 'ariot-${substr}'\r\n                echo '${deploy}'\r\n                def command = 'kubectl set image deployment/${deploy} ${deploy}=${DOCKER_REPOSITORY}/${server}:${build_time}_${commit_counters} -n hvpp'\r\n                echo '${command}'\r\n                sh 'ssh root@192.168.3.57 ${command}'\r\n              }\r\n            }\r\n          }\r\n        }\r\n\r\n        stage('\u6784\u5efa\u591a\u67b6\u6784\u955c\u50cf\uff0c\u81ea\u52a8\u66f4\u65b0\u6f14\u793a\u73af\u5883') {\r\n          when {\r\n            expression { return params.Environment.contains('PROD') }\r\n          }  \r\n\r\n          steps {\r\n            echo '\u6784\u5efa\u591a\u67b6\u6784\u955c\u50cf\uff0c\u5e76\u66f4\u65b0\u6f14\u793a\u73af\u5883'\r\n            script {\r\n              // \u767b\u5f55\u534e\u4e3a\u4e91\u955c\u50cf\u955c\u4ed3\u5e93\uff0c \u5929\u7ffc\u4e91\u955c\u50cf\u4ed3\u5e93\u65e0\u6cd5\u6253\u591a\u7248\u672c\u955c\u50cf\r\n              sh 'docker login -u cn-north-1@IY2FYXRHUQVKV5DAA1A2 -p 6d094a81650d98fdd2e476d3a6a5132ed2d63f5e1a48221ab4ea7a1f4fc18ee4 swr.cn-north-1.myhuaweicloud.com'\r\n              for (server in params.Servers.tokenize(',')) {\r\n\r\n                // docker buildx build -t registry.cn-gdgz1.ctyun.cn/h-vpp/hvpp-base:multiple --build-context name=/home/docker-test/aif-auth  --no-cache   --push --provenance=false .\r\n                sh 'cd ${build_dir}/${server} && docker buildx build -t swr.cn-north-1.myhuaweicloud.com/h-vpp/${server}:${build_time}_${commit_counters} ${multiple_platform} --no-cache --push --provenance=false .'\r\n \r\n                \r\n                // \u66f4\u65b0\u6f14\u793a\u73af\u5883(192.168.3.30)\u91ccdocker-compose\u91cc\u7684image\u503c\r\n                def image='swr.cn-north-1.myhuaweicloud.com/h-vpp/${server}:${build_time}_${commit_counters}'\r\n                sh '''\r\n                    ssh 192.168.3.30 'yq -i '.services.${server}.image=\\\\'${image}\\\\'' /home/hvpp-demo/backend/ariot.yaml'\r\n                    '''\r\n                // \u6267\u884c\u66f4\u65b0\u52a8\u4f5c\r\n                sh '''\r\n                    ssh 192.168.3.30 'cd /home/hvpp-demo/backend && docker-compose -f ariot.yaml up -d ${server}'\r\n                '''\r\n                // \u66f4\u65b0\u4e00\u4e2a\u955c\u50cf\u505c\u6b621s\r\n                sleep(1)\r\n              }\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n    }\r\n}\r\n\r\n```\r\n\r\n### \u524d\u7aef pipeline\u811a\u672c\r\n\r\n```groovy\r\npipeline {\r\n    agent any\r\n\r\n    options {\r\n        buildDiscarder(logRotator(numToKeepStr: '3')) //\u4fdd\u7559\u4e09\u4e2a\u5386\u53f2\u6784\u5efa\u7248\u672c\r\n    }\r\n    \r\n    tools {\r\n       jdk 'jdk-11'\r\n       nodejs 'nodejs-14.17.6'\r\n    }\r\n    \r\n    \r\n\r\n    parameters {\r\n        // \u4ee3\u7801\u5730\u5740\r\n        string(defaultValue: 'http://114.255.128.176:88/syb-dev/root/h-itmg/web/bcl/iot.git', description: '\u4ee3\u7801\u4ed3\u5e93\u5730\u5740', name: 'Gitlab_Registry_URL')\r\n        // \u7248\u672c\u5206\u652f\r\n        gitParameter(branch: '', branchFilter: '.*', defaultValue: 'release-dev', description: '\u4ee3\u7801\u5206\u652f', name: 'branch', quickFilterEnabled: false, selectedValue: 'NONE', sortMode: 'NONE', tagFilter: '*', type: 'GitParameterDefinition')\r\n        \r\n        choice(name: 'Environment',choices: ['DEV','TEST','PROD'],description: '\u9009\u7c7b\u578b')\r\n\r\n    }\r\n\r\n    environment {\r\n        commitLog = ''\r\n        commit_author = ''\r\n        ProjectName='${env.JOB_NAME}'\r\n        scannerHome = tool 'SonarQube_Scanner_4.8'\r\n    }\r\n\r\n    stages {\r\n        stage('\u4ee3\u7801\u62c9\u53d6') {\r\n            steps {\r\n                echo '\u62c9\u53d6Git\u4ee3\u7801'\r\n                checkout scmGit(branches: [[name: '${branch}']], extensions: [], userRemoteConfigs: [[credentialsId: '53773151-da42-4355-8504-45bcb0abb1eb', url: '${Gitlab_Registry_URL}']])\r\n                \r\n                script{\r\n                  // \u83b7\u53d6\u6700\u8fd1\u4e00\u6b21\u4ee3\u7801\u63d0\u4ea4\u4fe1\u606f\r\n                  commitLog = sh(script: 'git log --oneline -n 1',returnStdout: true).trim()\r\n                  echo 'Git Commit Log:\\n${commitLog}'\r\n                  \r\n                  commit_author = sh(script: 'git log -n 1 --pretty=format:'%an'',returnStdout: true).trim()\r\n                  echo 'Git Commit Author:\\n${commit_author}'\r\n        \r\n                  commit_counters = sh(script: 'git log --oneline | wc -l',returnStdout: true).trim()\r\n                  echo 'Git Commit Counters:\\n${commit_counters}'\r\n                } \r\n            }\r\n        }\r\n\r\n        stage('SonarQube Analysis') {\r\n            when {\r\n              expression { \r\n                  // \u68c0\u67e5\u590d\u9009\u6846\u7684\u503c\uff0c\u5982\u679c\u5305\u542b'DEV'\uff0c\u5219\u6267\u884c\u6b65\u9aa4\r\n                  return params.Environment.contains('DEV') \r\n              }\r\n            }\r\n            steps{\r\n                echo '\u4ee3\u7801\u8d28\u91cf\u68c0\u67e5'\r\n                script{\r\n                    def SonarQube_URL=env.SonarQube_URL\r\n                    def SonarQube_Secret=env.SonarQube_Secret\r\n\r\n                    echo '${ProjectName}'\r\n                    echo '${SonarQube_URL}'\r\n                    echo '${SonarQube_Secret}'\r\n                    \r\n                    echo '${JAVA_HOME}'\r\n\r\n                    withSonarQubeEnv('SonarQube') {\r\n                        sh '''\r\n                        ${scannerHome}/bin/sonar-scanner \\\r\n                        -Dsonar.projectKey=${ProjectName} \\\r\n                        -Dsonar.sources=. \\\r\n                        -Dsonar.host.url=${SonarQube_URL} \\\r\n                        -Dsonar.login=${SonarQube_Secret}\r\n                        '''\r\n                    }\r\n\r\n                    // \u4ee3\u7801\u68c0\u6d4b\u5931\u8d25,\u5c06\u4e0d\u518d\u7ee7\u7eed\u6267\u884c\u540e\u9762\u7684\u4efb\u52a1,\u76f4\u63a5\u9000\u51fa,\u62a5\u544a\u8fd4\u56de\u7684\u8d85\u65f6\u65f6\u957f\u8bbe\u4e3a5\u5206\u949f\r\n                    timeout(time: 3,unit: 'MINUTES') {\r\n                        waitForQualityGate abortPipeline: true\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        stage('\u7f16\u8bd1'){\r\n            when {\r\n                anyOf {\r\n                  expression { return params.Environment.contains('TEST') }\r\n                  expression { return params.Environment.contains('PROD') } \r\n                }\r\n            }\r\n            steps{\r\n                script{\r\n                    sh '''\r\n                    npm install\r\n                    npm run build\r\n                    '''\r\n                }\r\n            }\r\n        }\r\n        \r\n        stage('\u6d4b\u8bd5\u73af\u5883\u66f4\u65b0'){\r\n            when {\r\n                expression { return params.Environment.contains('TEST') }\r\n            }\r\n            steps{\r\n                script{\r\n                    sh '''\r\n                    rm -rf ariot\r\n                    mv dist ariot\r\n                    ssh root@192.168.3.55 'mv /usr/local/nginx/html/front/ariot  /usr/local/nginx/html/front/ariot-`date +%Y%m%d%H%M`'\r\n                    scp -r ariot root@192.168.3.55:/usr/local/nginx/html/front\r\n                    '''\r\n                }\r\n            }\r\n        }\r\n\r\n        stage('\u6f14\u793a\u73af\u5883\u66f4\u65b0'){\r\n            when {\r\n                expression { return params.Environment.contains('PORD') }\r\n            }\r\n            steps{\r\n                script{\r\n                    sh '''\r\n                    rm -rf ariot\r\n                    mv dist ariot\r\n                    ssh root@192.168.3.30 'mv /home/hvpp-demo/front/ariot  /home/hvpp-demo/front/ariot-`date +%Y%m%d%H%M`'\r\n                    scp -r ariot root@192.168.3.30:/home/hvpp-demo/front\r\n                    '''\r\n                }\r\n            }\r\n        }\r\n\r\n        \r\n    }\r\n}\r\n\r\n```\u3002", "top": 0, "createdAt": 1734942460, "style": "", "script": "", "head": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2024-12-23", "dateLabelColor": "#bc4c00"}}, "singeListJson": {}, "labelColorDict": {"bug": "#d73a4a", "documentation": "#0075ca", "duplicate": "#cfd3d7", "enhancement": "#a2eeef", "good first issue": "#7057ff", "help wanted": "#008672", "invalid": "#e4e669", "question": "#d876e3", "wontfix": "#ffffff"}, "displayTitle": "Blog Title", "faviconUrl": "https://github.githubassets.com/favicons/favicon.svg", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "primerCSS": "<link href='https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/Primer/21.0.7/primer.css' rel='stylesheet' />", "homeUrl": "https://ignorantcaomao.github.io", "prevUrl": "disabled", "nextUrl": "disabled"}